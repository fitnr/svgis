# This file is part of svgis.
# https://github.com/fitnr/svgis

# Licensed under the GNU General Public License v3 (GPLv3) license:
# http://opensource.org/licenses/GPL-3.0
# Copyright (c) 2015, Neil Freeman <contact@fakeisthenewreal.org>

language: python

python:
    - 2.7
    - 3.3
    - 3.4
    - 3.5

os:
 - linux

git:
  depth: 3

sudo: true

env:
  - NUMPY=no  CLIP=yes INLINE=yes 
  - NUMPY=yes CLIP=yes INLINE=yes
  - NUMPY=no
  - NUMPY=yes

matrix:
  exclude:
    - python: 3.3
      env: NUMPY=yes
    - python: 3.3
      env: NUMPY=no
    - python: 3.4
      env: NUMPY=no
    - python: 3.4
      env: NUMPY=yes

cache:
  directories:
    - $HOME/.cache/pip

before_install:
    - if [[ $TRAVIS_OS_NAME == "linux" ]]; then sudo apt-get -qq update; fi
    - if [[ $TRAVIS_OS_NAME == "linux" ]]; then sudo apt-get -qq install -y libgdal1-dev; fi
    - if [[ $TRAVIS_OS_NAME == "linux" && $INLINE == "yes" ]]; then sudo apt-get -qq install -y libxml2-dev libxslt-dev python-dev; fi
    - pip install docutils coverage
    - if [[ $NUMPY == "yes" ]]; then pip install numpy; fi

install:
    - make
    - python setup.py install
    - if [[ $CLIP == "yes" ]]; then pip install -e .[clip]; fi
    - if [[ $INLINE == "yes" ]]; then pip install -e .[inline]; fi

script:
    - make test PYTHONFLAGS="-W ignore" QUIET= -W svgis/test_data/cb_2014_us_nation_20m.zip

after_script:
    - make cov
    - make profile
